<style>
  .compra-rapida-bold {
    height: 100dvh;
    width: 380px;
    background: var(--color-background);
    position: fixed;
    right: 0;
    top: 0;
    z-index: 999;
  }

  .content-compra-rapida {
    position: relative;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    height: 100%;
  }

  .compra-rapida-bold .lista-compra-rapida {
    list-style: none;
    padding: 0;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    overflow-x: hidden;
    flex-grow: 1;
    margin: 0;
    scroll-behavior: smooth;
  }

  .compra-rapida-bold .item-compra-rapida {
    display: flex;
    border-bottom: var(--cart-item-border-width) var(--cart-item-border-style) var(--bgLight);
    padding-bottom: 10px;
    padding-top: 10px;
    background-color: var(--cart-item-bg);
    align-items: center;
    gap: 10px;
  }

  .compra-rapida-bold .item-compra-rapida.out-of-stock {
    opacity: 0.5;
    pointer-events: none;
    user-select: none;
  }

  .compra-rapida-bold .item-compra-rapida.out-of-stock .sold-out {
    font-weight: 900;
    text-transform: uppercase;
  }

  .compra-rapida-bold .item-compra-rapida:last-child {
    border-bottom: 0px;
  }

  .compra-rapida-bold a.previewCartItem-image {
    display: block;
    height: 70px;
    width: 70px;
    top: 0;
    position: relative;
  }

  .compra-rapida-bold .previewCartItem-image:before {
    display: none;
  }

  .compra-rapida-header {
    border-bottom: var(--cart-item-border-width) var(--cart-item-border-style) var(--cart-item-border);
  }

  .compra-rapida-header h3 {
    margin: 0;
  }

  .compra-rapida-bold .cart_title_price {
    width: 160px;
    display: flex;
    align-items: flex-start;
    flex-direction: column;
    justify-content: center;
  }

  .compra-rapida-bold .previewCartItem-qty .btn-quantity {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    background: transparent !important;
  }

  .compra-rapida-bold .btn-quantity svg {
    width: 10px;
    height: auto;
    fill: none;
    stroke-width: 2.5px;
    pointer-events: none; 
    fill: var(--cor-icons);
  }

  .compra-rapida-bold .btn-quantity svg path {
    transition: color 0.5s ease;
  }

  .compra-rapida-bold .previewCartItem-qty .btn-quantity:before,
  .compra-rapida-bold .previewCartItem-qty .btn-quantity:after {
    display: none;
  }

  .compra-rapida-bold .quantity-compra-rapida {
    width: calc(100% - 160px - 110px);
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-left: 10px;
  }

  .compra-rapida-bold .remove-item {
    font-size: 11px;
    line-height: 1;
    margin-top: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 3px;
    cursor: pointer;
    color: #8b8b8b;
  }

  .compra-rapida-bold .remove-item:hover,
  .compra-rapida-bold .remove-item:hover svg {
    color: #000;
    stroke: #000;
  }

  .compra-rapida-bold .remove-item svg {
    fill: none;
    width: 11px;
    height: auto;
    margin-top: -2px;
  }

  .compra-rapida-bold .previewCartItem-qty {
    margin-top: 0px;
    margin-left: 0;
    width: 100%;
  }

  .item-compra-price .price {
    justify-content: flex-start;
  }

  .item-compra-name span {
    font-size: 14px;
    text-transform: initial !important;
    font-weight: 600;
    line-height: 1rem !important;
    -webkit-line-clamp: 4;
    color: var(--lv_1_color);
    font-family: var(--font-body-family);
  }

  .compra-rapida-bold .item-compra-name {
    line-height: 1;
  }

  .footer-compra-rapida {
    padding: 15px 20px 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    border-top: 1px solid var(--bgLight);
  }

  /* .footer-compra-rapida .button {
    background: var(--product-color) !important;
    border-color: var(--product-color) !important;
    color: #fff9f2 !important;
  } */

  body.compra-rapida-aberto .background-overlay {
    opacity: 1;
    pointer-events: all;
  }

  body.compra-rapida-aberto {
    overflow: hidden;
  }

  .minus.btn-quantity.item-not-added {
    pointer-events: none;
  }

  .minus.btn-quantity.item-not-added svg path {
    fill: var(--cor-icons) !important;
  }

  .compra-rapida-bold .item-compra-rapida:not(:hover) {
    background-color: var(--color-background) !important;
  }

  .compra-rapida-bold .item-compra-rapida {
    background-color: var(--color-background) !important;
  }

  body.compra-rapida-aberto .compra-rapida-bold {
    transform: translateZ(0);
    opacity: 1;
    visibility: visible;
  }

  body:not(.compra-rapida-aberto) .compra-rapida-bold {
    transform: translateZ(-100%);
    opacity: 0;
    visibility: hidden;
  }

  .navegacao-compra-rapida {
    display: flex;
    gap: 5px;
    justify-content: space-between;
    align-items: center;
    padding: 5px;
    background: var(--color-background);
    height: 150px;
    overflow-y: auto;
  }

  .navegacao-compra-rapida .seletor-compra {
    width: 100%;
    text-align: center;
    font-size: 14px;
    cursor: pointer;
    border-radius: 20px;
    font-weight: 900;
    height: 40px;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
    margin-bottom: 5px;
    padding: 0 15px;
    min-width: fit-content;
    white-space: nowrap;
  }

  .divisao-compra-rapida h3 {
    margin: 0;
    color: var(--color);
    text-align: center;
    line-height: 2;
    font-family: var(--font-body-family);
    font-weight: 700;
    text-transform: uppercase;
  }

  cart-update-compra-rapida input {
    border: none !important;
    background: var(--color-background) !important;
  }

  .total-line-compra-rapida {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .total-line-compra-rapida .old-price {
    text-decoration: line-through;
    text-align: right;
    color: #959798;
    font-size: 14px;
  }

  .compra-rapida-bold .item-compra-price .price {
    font-size: 13px;
    color: #959595;
    gap: 5px;
  }

  .compra-rapida-bold .item-compra-price .price > s + span {
    color: #27ae60;
    font-weight: 700;
  }

  [total-compra-rapida] {
    font-size: 26px;
    font-weight: 600;
    color: var(--lv_1_color);
  }

  .pix-total {
    display: flex;
    flex-direction: column;
    align-content: end;
    flex-wrap: wrap;
    text-align: right;
  }

  .total-compra-rapida .pix-aviso {
    font-size: 12px;
    line-height: 1.2;
  }

  .pix-total-discount-container .pix-aviso {
    font-size: 12px;
    line-height: 1.2;
  }

  .pix-total-discount-container .pix-icon svg {
    width: 30px;
    height: auto;
  }

  .pix-total-discount-container {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 5px;
  }

  .pix-total-discount-container svg {
    margin-top: -4px;
  }

  span.label-total {
    font-size: 20px;
    font-weight: 600;
    color: var(--lv_1_color);
  }

  [fechar-compra-rapida] {
    cursor: pointer;
    text-align: center;
    font-size: 14px;
    line-height: 1;
    color: var(--lv_1_color);
  }

  [fechar-compra-rapida] {
    margin-bottom: 20px;
  }

  .content-compra-rapida.is-loading circle {
    display: block;
    stroke-dasharray: 280;
    stroke-dashoffset: 0;
    transform-origin: center;
    stroke: var(--color-background-global);
    animation: dash 1.4s ease-in-out infinite;
  }

  .navegacao-compra-rapida .seletor-compra svg {
    width: 11px;
    height: auto;
    stroke: none;
    fill: none;
    margin-top: -5px;
    margin-right: 5px;
  }

  .introjs-helperLayer,
  .introjs-overlay {
    display: inherit;
  }

  .section-items li {
    max-width: 95%;
    margin: 0 auto;
  }

  .section-items .divisao-compra-rapida {
    background-color: #00adbb;
    border-radius: 20px;
    margin: 15px 0;
  }

  .previewCartItem-qty .form-input.quantity.zero + .btn-quantity.plus svg path {
    color: var(--cor-icons) !important;
    fill: var(--cor-icons) !important;
  }

  .content-compra-rapida .form-input.quantity.zero,
  .content-compra-rapida .form-input.quantity,
  .previewCartItem-qty .form-input.quantity.zero + .btn-quantity.plus svg path  {
    color: transparent;
    background: var(--cr-background) !important;
    -webkit-background-clip: text !important;
    -webkit-text-fill-color: transparent;
  }

  .content-compra-rapida .form-input.quantity {
    font-size: 32px;
    font-weight: 900;
    transition: color 0.5s ease;
  }
  .close-icon-compra-rapida {
    border-radius: 50%;
    min-width: 32px;
    height: 32px;
    padding: 5px;
    display: flex;
    align-items: center;
    margin-bottom: 0px;
    justify-content: center;
  }

  @media (max-width: 767px) {
    .compra-rapida-bold {
      width: 100vw;
    }
  }

  .header-compra-rapida svg {
    width: 24px;
    height: 24px;
    stroke: none;
  }

  .header-compra-rapida svg path {
    fill: var(--header_icons_color);
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/intro.js@7.2.0/intro.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/intro.js@7.2.0/minified/introjs.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/Flip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollToPlugin.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/TextPlugin.min.js"></script>

<div class="compra-rapida-bold">
  <div class="content-compra-rapida">
    <div
      data-intro="Seja bem vindo(a) à compra rápida, utilize os filtros para localizar facilmente sua proteína favorita."
      class="navegacao-compra-rapida"
    >
      {% for block in section.blocks %}
        <span
          class="seletor-compra"
          style="background: {{ block.settings.cor }};color: {{ block.settings.cor_texto }};"
          data-target-section="{{block.settings.collection.handle}}"
        >
          {% comment %} <svg xmlns="http://www.w3.org/2000/svg" width="800px" height="800px" viewBox="0 0 24 24" fill="none"> <path d="M3 4.6C3 4.03995 3 3.75992 3.10899 3.54601C3.20487 3.35785 3.35785 3.20487 3.54601 3.10899C3.75992 3 4.03995 3 4.6 3H19.4C19.9601 3 20.2401 3 20.454 3.10899C20.6422 3.20487 20.7951 3.35785 20.891 3.54601C21 3.75992 21 4.03995 21 4.6V6.33726C21 6.58185 21 6.70414 20.9724 6.81923C20.9479 6.92127 20.9075 7.01881 20.8526 7.10828C20.7908 7.2092 20.7043 7.29568 20.5314 7.46863L14.4686 13.5314C14.2957 13.7043 14.2092 13.7908 14.1474 13.8917C14.0925 13.9812 14.0521 14.0787 14.0276 14.1808C14 14.2959 14 14.4182 14 14.6627V17L10 21V14.6627C10 14.4182 10 14.2959 9.97237 14.1808C9.94787 14.0787 9.90747 13.9812 9.85264 13.8917C9.7908 13.7908 9.70432 13.7043 9.53137 13.5314L3.46863 7.46863C3.29568 7.29568 3.2092 7.2092 3.14736 7.10828C3.09253 7.01881 3.05213 6.92127 3.02763 6.81923C3 6.70414 3 6.58185 3 6.33726V4.6Z" stroke="{{ block.settings.cor_texto }}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/> </svg>{% endcomment %}
          {{- block.settings.title -}}
        </span>
      {% endfor %}
      <div fechar-compra-rapida class="close-icon-compra-rapida">
        {% render 'icon-close' %}
      </div>
    </div>
    <ul class="lista-compra-rapida">
      {% for block in section.blocks %}
        <div style="--cr-background: {{ block.settings.cor }}; --cor-icons: {{ block.settings.cor_icons |  default: 'var(--lv_1_color)' }};" class="section-items" data-linha="{{block.settings.collection.handle}}">
          <li>
            <div class="divisao-compra-rapida" style="background: {{ block.settings.cor }}">
              <h3 style="--color: {{ block.settings.cor_texto }}">{{ block.settings.title }}</h3>
            </div>
          </li>
          {% for product in block.settings.collection.products %}
            <li class="item-compra-rapida{% unless product.available %} out-of-stock{% endunless %}">
              <a
                href="{{ product.url }}"
                class="previewCartItem-image{% if product.compare_at_price > product.price %} sale-badge{% endif %}"
              >
                <img
                  srcset="{{product.featured_image | image_url: width: 110  }}"
                  src="{{product.featured_image | image_url: width: 110  }}"
                  width="110"
                  height="110"
                  alt="{{product.title}}"
                  sizes="auto"
                  loading="lazy"
                >
              </a>
              <div class="cart_title_price">
                <a class="item-compra-name" href="{{product.url}}">
                  <span class="text">{{ product.metafields.custom.taste.value.name.value |  default: product.title }}</span>
                </a>
                <div class="item-compra-price">
                  <span class="price{% if product.compare_at_price > product.price %} sale{% endif %}">
                    {% if product.compare_at_price > product.price %}
                      <s>{{ product.compare_at_price | money }}</s>
                    {% endif %}
                    <span>{{ product.price | money }}</span>
                  </span>
                  {% unless product.available %}
                    <span class="sold-out">Esgotado</span>
                  {% endunless %}
                </div>
              </div>
              <div
                class="quantity-compra-rapida"
                {% if quantidadeItemTuts != true %}
                  {%- assign quantidadeItemTuts = true %} data-intro="Selecione a quantidade de cada item"
                {% endif %}
              >
                <cart-update-compra-rapida
                  class="previewCartItem-qty"
                  {% if product.selected_or_first_available_variant.inventory_quantity < 1
                    and product.selected_or_first_available_variant.available
                  %}
                    data-inventory="9999"
                  {% else %}
                    data-inventory="{{ product.selected_or_first_available_variant.inventory_quantity }}"
                  {% endif %}
                  data-product="{{ product.id }}"
                  data-variant="{{ product.selected_or_first_available_variant.id }}"
                >
                  <a href="#" data-minus-quantity-cart="" class="minus btn-quantity item-not-added">
                    <svg focusable="false" class="icon icon--minus" viewBox="0 0 10 2" role="presentation">
                      <path d="M10 0v2H0V0z" fill="{{block.settings.cor}}"></path>
                    </svg>
                  </a>
                  <input
                    data-old-price="{{ product.compare_at_price }}"
                    data-price="{{ product.price }}"
                    data-color="{{block.settings.cor_texto}}"
                    style="color: {{block.settings.cor}};"
                    class="form-input quantity zero"
                    name="quantity"
                    value="0"
                    type="number"
                  >
                  <a href="#" data-plus-quantity-cart="" class="plus btn-quantity">
                    <svg
                      fill="{{block.settings.cor}}"
                      focusable="false"
                      class="icon icon--plus"
                      viewBox="0 0 10 10"
                      role="presentation"
                    >
                      <path d="M6 4h4v2H6v4H4V6H0V4h4V0h2v4z" fill="{{block.settings.cor}}" fill-rule="evenodd"></path>
                    </svg>
                  </a>
                </cart-update-compra-rapida>
                {% comment %}
                  <div class="remove-item"{% if zerarItemTuts != true %}{% assign zerarItemTuts = true %} data-intro='Caso precise zerar a quantidade de um item especifico, clique em Limpar'{%endif%} remove-all>
                    <svg class="trash-icon" viewBox="0 0 24 24" width="17" fill="#000">
                      <polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                    Limpar
                  </div>
                {% endcomment %}
              </div>
            </li>
          {% endfor %}
        </div>
      {% endfor %}
    </ul>
    <div class="footer-compra-rapida">
      <div class="total-line-compra-rapida">
        <span class="label-total">Total</span>
        <div class="total-compra-rapida">
          <div class="old-price" style="display:none" hide-for-zero>
            <span class="money" total-compare-price>R$ 0</span>
          </div>
          {% if settings.desconto_avista %}
            <div class="pix-total">
              <span class="pix-total-discount-container">
                <span class="pix-icon" hide-for-zero>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    version="1.1"
                    id="Layer_1"
                    x="0px"
                    y="0px"
                    viewBox="0 0 194 194"
                    style="enable-background:new 0 0 194 194;"
                    xml:space="preserve"
                  >
                    <g> <path id="path2376_2_" d="M147.04,144.34c-7.02,0-13.6-2.7-18.57-7.67L101.7,109.9c-1.84-1.84-5.18-1.84-7.02,0L67.8,136.78   c-4.97,4.97-11.55,7.67-18.57,7.67h-5.29l34.01,34.01c10.58,10.58,27.85,10.58,38.43,0l34.11-34.11L147.04,144.34L147.04,144.34z"></path> <path id="path2380_2_" d="M49.12,49.55c7.02,0,13.6,2.7,18.57,7.67L94.57,84.1c1.94,1.94,5.07,1.94,7.02,0l26.88-26.77   c4.97-4.97,11.55-7.67,18.57-7.67h3.24l-34.11-34.11c-10.58-10.58-27.85-10.58-38.43,0L43.72,49.55H49.12L49.12,49.55z"></path> <path id="path2384_2_" d="M178.45,77.84l-20.62-20.62c-0.43,0.22-0.97,0.32-1.51,0.32h-9.39c-4.86,0-9.61,1.94-12.95,5.4   L107.2,89.71c-2.48,2.48-5.83,3.78-9.07,3.78c-3.35,0-6.59-1.3-9.07-3.78L62.18,62.83c-3.45-3.45-8.2-5.4-12.95-5.4H37.68   c-0.54,0-0.97-0.11-1.4-0.32L15.55,77.84c-10.58,10.58-10.58,27.85,0,38.43l20.62,20.62c0.43-0.22,0.86-0.32,1.4-0.32h11.55   c4.86,0,9.61-1.94,12.95-5.4l26.88-26.88c4.86-4.86,13.39-4.86,18.24,0l26.77,26.77c3.45,3.45,8.2,5.4,12.95,5.4h9.39   c0.54,0,0.97,0.11,1.51,0.32l20.62-20.62C189.03,105.58,189.03,88.42,178.45,77.84"></path> </g>
                  </svg>
                </span>
                <span class="money" total-compra-rapida>R$ 0</span>
              </span>
              <span class="pix-aviso" hide-for-zero>A vista no PIX com até {{ settings.porcentagem_avista }}% OFF</span>
            </div>
          {% else %}
            <span class="money" total-compra-rapida>R$ 0</span>
          {% endif %}
        </div>
      </div>
      <button
        class="button button-1 button-checkout button-gradient"
        data-intro="Depois é só clicar em Adicionar ao carrinho e prosseguir com sua compra."
        compra-rapida-add
      >
        Adicionar ao carrinho
      </button>
      <span fechar-compra-rapida>Fechar compra rápida</span>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/Flip.min.js" defer="defer"></script>
<script>
  $(document).ready(function(){

    gsap.registerPlugin(Flip);

    window.cart = {{cart | json}};

    const linhas = gsap.utils.toArray(".section-items");

    $(document).on('click', '.seletor-compra', function(e){

      const state = Flip.getState(linhas);

      let target = $(this).data('target-section');
      $(`[data-linha="${target}"]`).prependTo('.lista-compra-rapida');

      
      Flip.from(state, {duration: 1, ease: "power1.inOut"});

      document.querySelector('.lista-compra-rapida').scrollTo(0, 0);
    })
    

    document.addEventListener('cart.updated', function(event) {
      // O objeto 'event.detail' contém informações sobre o carrinho atualizado
      var novoCarrinho = event.detail;

      // Atualize a variável global com o novo carrinho
      carrinhoShopify = novoCarrinho;

      // Faça o que quiser com o novo carrinho aqui
      console.log("Novo carrinho:", carrinhoShopify);
    });

    $('cart-update-compra-rapida input').on('change', function(){
      changeQuantity(this);
      if ($(this).val() == 0) {
        $(this).addClass('zero');
      } else {
        $(this).removeClass('zero');
      }
    })

    function calcTotal(){
      let total = 0;
      let totalCompare = 0;
      let totalWithDiscount = 0;

      $('.quantity-compra-rapida input').each(function( index ) {
        let qtd = parseInt($(this).val());
        let price = parseInt($(this).data('price'));
        let oldPrice = parseInt($(this).data('old-price')) || 0;
        totalCompare += oldPrice * qtd;
        total += price * qtd;
      })

      {% if settings.desconto_avista %}
      let percentage = parseInt({{settings.porcentagem_avista}}) / 100;
      totalWithDiscount = Math.abs((total * percentage - total ));
      {% endif %}

      if(total > 0){
        $('[hide-for-zero]').show();
      }else{
        $('[hide-for-zero]').hide();
      }

      if(totalWithDiscount > 0){
        $('[total-compare-price]').html(Shopify.formatMoney(total, window.money_format));
        $('.old-price').show();
      }else{
        $('[total-compare-price]').empty();
      }

      {%- if settings.desconto_avista -%}
        $('[total-compra-rapida]').html(Shopify.formatMoney(totalWithDiscount, window.money_format)); 
      {%- else -%}
        $('[total-compra-rapida]').html(Shopify.formatMoney(total, window.money_format));
      {%- endif -%}

      
      console.log(totalCompare, total);
    }

    function changeQuantity(element, action){
      let inventory = parseInt($(element).closest('cart-update-compra-rapida').data('inventory'));
      let variant = parseInt($(element).closest('cart-update-compra-rapida').data('variant'));
      let newQtd = parseInt($(element).closest('cart-update-compra-rapida').find('input').val());  
      let color = $(element).data('color');  
      let buttonMinus = $(element).prev();
      let buttonPlus = $(element).next();
      let trashIcon = `<svg class="trash-icon" viewBox="0 0 24 24" width="17"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>`
      let minusIcon = `<svg focusable="false" class="icon icon--minus" viewBox="0 0 10 2" role="presentation"><path d="M10 0v2H0V0z" fill="${color}"></path></svg>`;

      switch(action){
        case "add":
          newQtd = newQtd + 1
          break
        case "remove":
          newQtd = newQtd - 1
          break
      }

      if(newQtd > 0){
        buttonMinus.removeClass('item-not-added');
        //buttonMinus.html(minusIcon).removeClass('item-not-added');
      }else{
        buttonMinus.addClass('item-not-added');
        //buttonMinus.html(trashIcon).addClass('item-not-added');
      }

      var itensFiltrados = $.grep(window.cart.items, function(item) {
        return item.variant_id === variant;
      });

      if(itensFiltrados.length){
        inventory = inventory - itensFiltrados[0].quantity;
      }

      if(newQtd > inventory){
        $(element).val(inventory)
        calcTotal();
        console.log('Quantidade excede o limit')
        return;
      }

      if(newQtd < 0){
        $(element).val(0)
        calcTotal();
        console.log('Quantidade é zero ou menor')
        return;
      }

      $(element).val(newQtd);
      calcTotal();    
    }

    $(document).on('click', 'cart-update-compra-rapida [data-plus-quantity-cart]', function(e){
      let input = $(this).prev();
      changeQuantity(input, "add")
      if ($(input).val() == 0)
        $(input).addClass('zero');
      else $(input).removeClass('zero')
    })

    $(document).on('click', 'cart-update-compra-rapida [data-minus-quantity-cart]', function(e){
      let input = $(this).next();
      changeQuantity(input, "remove")
      if ($(input).val() == 0)
        $(input).addClass('zero');
      else $(input).removeClass('zero')
    })

    // $(document).on('click', '[remove-all]', function(e){
    //  let input = $(this).prev().find('input');
    //  input.val(0).trigger("change");
    // })

    $(document).on('click', '[fechar-compra-rapida]', function(e){
      $('body').removeClass('compra-rapida-aberto');
    })

    $('.background-overlay').on('click', function(){
        $('body').removeClass('compra-rapida-aberto');
    })

    /*Adicionar ao carrinho*/

    Shopify.moveAlong = function() {
        if (Shopify.queue.length) {
          var request = Shopify.queue.shift();
          let dataForm = 'quantity=' + request.quantity + '&id=' + request.variantId;
          var params = {
            type: 'POST',
            url: '/cart/add.js?_easygift_internal=true',
            data: dataForm,
            dataType: 'json',
            beforeSend: function(){
              if(!$('.content-compra-rapida').hasClass('is-loading')){
                $('.content-compra-rapida').addClass('is-loading').prepend(`<div class="loading-overlay loading-overlay--custom">
                    <div class="loading-overlay__spinner">
                        <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                            <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                        </svg>
                    </div>
                </div>`)
              }
            },
            success: function(line_item) {
               Shopify.moveAlong()
            },
            error: function(XMLHttpRequest, textStatus) {
                console.log("Erro ao adicionar")
            }
          }
          
          $.ajax(params);
        }else {
          $('.content-compra-rapida').removeClass('is-loading');
          $('.content-compra-rapida').find('loading-overlay--custom').remove();
          $('body').removeClass('compra-rapida-aberto');
          Shopify.getCart((cartTotal) => {
              $('body').addClass('cart-sidebar-show');
              $('body').find('[data-cart-count]').text(cartTotal.item_count);
              window.updateCart(cartTotal);
          })
        }
    };

    function push_to_queue(variantID, quantity, callback) {
      Shopify.queue.push({
        variantId: variantID,
        quantity: quantity
      })
    }

    $(document).on("click", "[compra-rapida-add]", function(e) {
       Shopify.queue = [];
       $('cart-update-compra-rapida').each(function(i){
         let id = parseInt($(this).attr('data-variant'));
         let qtd = parseInt($(this).find('input').val());

         if(qtd > 0){
          push_to_queue(id, qtd);
         }
       })

       Shopify.moveAlong();
    })


    $('[href="#compra-rapida"]').click(function(){
      $('body').addClass('compra-rapida-aberto')
      if (!localStorage.getItem('primeiroAcesso')) {
        introJs().setOption("nextLabel","Próximo").setOption("prevLabel","Anterior").setOption("doneLabel","Fechar").start();
        localStorage.setItem('primeiroAcesso', 'true');
      }
    });

    if ($('#compra-rapida-trigger.not-initialized').length > 0) {
      $('#compra-rapida-trigger.not-initialized').toggleClass(['not-initialized', 'initialized']);
      setTimeout(() => {
        $('#compra-rapida-trigger.initialized').addClass('animate');
      }, 1500);
      setTimeout(() => {
        $('#compra-rapida-trigger.initialized').removeClass('animate');
      }, 6000);
    };
  })
</script>

{% schema %}
{
  "name": "Compra Rápida",
  "class": "kit-container",
  "settings": [],
  "blocks": [
    {
      "type": "collection",
      "name": "collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Coleção"
        },
        {
          "type": "color_background",
          "id": "cor",
          "label": "Cor destaque"
        },
        {
          "type": "color",
          "id": "cor_texto",
          "label": "Cor texto destaque"
        },
        {
          "type": "color",
          "id": "cor_icons",
          "label": "Cor dos icones"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Título"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Compra Rápida"
    }
  ]
}
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}